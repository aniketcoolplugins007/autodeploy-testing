name: Plugin Quality Check & Conditional Deploy

on:
  push:
    branches:
      - "**"   # runs only when you push a tag

permissions:
  contents: write  # required to delete remote tags

jobs:
  plugin-check:
    name: Run Plugin Quality Check
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run WordPress Plugin Check
        id: check
        uses: wordpress/plugin-check-action@v1
        with:
          build-dir: './'
          exclude-directories: |
            vendor
            third-party
            node_modules
          categories: |
            plugin_repo
            security
          strict: true

      - name: Summary (success)
        if: success()
        run: echo "âœ… Plugin Check passed."

      - name: send fails error message to the user
        if: failure()
        run: |
          echo "=== ðŸ§© WordPress Plugin Check Results ==="
          if [ -f /home/runner/work/_temp/plugin-check-results.txt ]; then
            cat /home/runner/work/_temp/plugin-check-results.txt
          else
            echo "No results file found!"
          fi
